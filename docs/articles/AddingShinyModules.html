<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Adding Shiny Modules • OhdsiShinyModules</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Adding Shiny Modules">
<meta property="og:description" content="OhdsiShinyModules">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">OhdsiShinyModules</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../articles/AddingShinyModules.html">Contribute</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AddingShinyModules.html">Adding Shiny Modules</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/PatientLevelPrediction" class="external-link">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Adding Shiny Modules</h1>
                        <h4 data-toc-skip class="author">Jenna Reps, Jamie Gilbert, Josh Ide</h4>
            
            <h4 data-toc-skip class="date">2022-07-05</h4>
      
      
      <div class="hidden name"><code>AddingShinyModules.Rmd</code></div>

    </div>

    
    
<!--
%\VignetteEngine{knitr}
%\VignetteIndexEntry{Adding Shiny Modules}
-->
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>A shiny module consists of two parts: the user interface (UI) function and the server function. The UI function contains the code that specifies what inputs/outputs are seen when the module is called and the server function contains the code to do any process required by the module. If an input is dynamic (e.g., it depends on some user interaction) then it may need to be specified in the server rather than the UI.</p>
</div>
<div class="section level2">
<h2 id="what-is-a-shiny-module">What Is A Shiny Module<a class="anchor" aria-label="anchor" href="#what-is-a-shiny-module"></a>
</h2>
<p>Both the UI function and server function require the input <code>id</code> that is a string and much match between the UI and server for the same module instance. For a nice tutorial on shiny modules see <a href="https://shiny.rstudio.com/articles/modules.html" class="external-link">this website</a>.</p>
<div class="section level3">
<h3 id="ui-module-function">UI module function<a class="anchor" aria-label="anchor" href="#ui-module-function"></a>
</h3>
<p>The module’s UI function specifies how the shiny module will be displayed to the user. The string variable <code>id</code> should be an input for every model UI as it is used to create the namespace. The main aspect of a UI module is the namespace function <code>ns &lt;- shiny::NS(id)</code>. This is put as the first line of any module UI function. Effectively, what this function does is append the id string to the input of the <code>ns()</code> function. For example, if a user calls the UI module by running <code>exampleViewer(id = 'example_name')</code> then the namespace function <code>ns()</code> will concatenate the string ‘example_name’ to every reference in the UI, e.g., <code>ns('serverReference') = 'example_name_serverReference'</code>. Therefore, as long as the <code>id</code> input values are unique for each instance of a module, the references within the modules viewer and server will be unique and not clash across modules.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exampleViewer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">id</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ns</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/NS.html" class="external-link">NS</a></span><span class="op">(</span><span class="va">id</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidRow</a></span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/column.html" class="external-link">column</a></span><span class="op">(</span>width <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                  </span>
<span>                  <span class="fu">shinydashboard</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shinydashboard/man/box.html" class="external-link">box</a></span><span class="op">(</span></span>
<span>                    width <span class="op">=</span> <span class="fl">12</span>,</span>
<span>                    title <span class="op">=</span> <span class="st">"Example Title "</span>,</span>
<span>                    status <span class="op">=</span> <span class="st">"info"</span>, </span>
<span>                    solidHeader <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                    <span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/dataTableOutput.html" class="external-link">dataTableOutput</a></span><span class="op">(</span><span class="fu">ns</span><span class="op">(</span><span class="st">'serverReference'</span><span class="op">)</span><span class="op">)</span>              </span>
<span>                  <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="server-module-function">Server module function<a class="anchor" aria-label="anchor" href="#server-module-function"></a>
</h3>
<p>The module’s server function is where all the data fetching and manipulation happens. The module server and UI server is linked by using the same <code>id</code> for example, when calling the server you would use <code>exampleServer(id = 'example_name')</code>. For the example above, the server function needs to specify what the <code>serverReference</code> dataTable is. The server automatically knows the namespace, so the <code>DT::dataTableOutput(ns('serverReference'))</code> can be define using the output <code>output$serverReference</code> (no namespace fucntion is require in the server code).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">exampleServer</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span></span>
<span>  <span class="va">id</span>,</span>
<span>  <span class="va">extraInput</span></span>
<span>  <span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/moduleServer.html" class="external-link">moduleServer</a></span><span class="op">(</span></span>
<span>    <span class="va">id</span>,</span>
<span>    <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>      </span>
<span>      <span class="va">output</span><span class="op">$</span><span class="va">serverReference</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>a<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, b<span class="op">=</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span><span class="op">)</span></span>
<span>  </span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="calling-the-modules-in-the-main-ui-and-server">Calling the modules in the main UI and server<a class="anchor" aria-label="anchor" href="#calling-the-modules-in-the-main-ui-and-server"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/fluidPage.html" class="external-link">fluidPage</a></span><span class="op">(</span></span>
<span>  <span class="fu">exampleViewer</span><span class="op">(</span><span class="st">"exampleName"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span>, <span class="va">session</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">exampleServer</span><span class="op">(</span><span class="st">"exampleName"</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/shinyApp.html" class="external-link">shinyApp</a></span><span class="op">(</span><span class="va">ui</span>, <span class="va">server</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="useful-shiny-packages">Useful shiny packages<a class="anchor" aria-label="anchor" href="#useful-shiny-packages"></a>
</h3>
<p>The following packages are useful for developing shiny modules:</p>
<ul>
<li>reactable: contains a nice shiny table</li>
<li>plotly: used to create interactive plots</li>
<li>ggplot: used to create static plots</li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="guidelines-for-contributing-a-module">Guidelines for contributing a module<a class="anchor" aria-label="anchor" href="#guidelines-for-contributing-a-module"></a>
</h2>
<p>If you would like to add a new module please ensure you follow the following guidelines:</p>
<div class="section level3">
<h3 id="style">Style<a class="anchor" aria-label="anchor" href="#style"></a>
</h3>
<p>We recommend following the HADES coding style <a href="https://ohdsi.github.io/Hades/codeStyle.html" class="external-link">details here</a>.</p>
</div>
<div class="section level3">
<h3 id="file-names">File names<a class="anchor" aria-label="anchor" href="#file-names"></a>
</h3>
<p>Please name files in the following format: The main module should be called <code>&lt;module name&gt;-main.R</code> and the submodules within that module should be called <code>&lt;module name&gt;-&lt;submodule name&gt;.R</code> for example the main prediction module is called <code>prediction-main.R</code> and the discrimination sub module within the prediction module is called <code>prediction-discrimination.R</code>.</p>
</div>
<div class="section level3">
<h3 id="helpinformation-buttons">Help/Information buttons<a class="anchor" aria-label="anchor" href="#helpinformation-buttons"></a>
</h3>
<p>Please place any html or markdown files inside the package ‘inst’ folder. The helper information about the module should be inside the subfolder ‘<module name>-document’ and any helper files used within the module should be in ‘<module name>-www’. The location of these files can be determine within the module using the following code:</module></module></p>
<p><code>system.file('&lt;module name&gt;-www', file, package = "OhdsiShinyModules")</code></p>
<p>See <code>R/helpers-getHelp.R</code> to see any example of a function used by the prediction module to get the helper file locations.</p>
</div>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a>
</h3>
<p>A new module must have &gt;80\% test coverage before it is added to the package. Testing shiny modules is similar to testing R packages with testthat, however, there are some notable specific differences for this set up that must be followed.</p>
<p>Testing of module servers can be done using the <code><a href="https://rdrr.io/pkg/shiny/man/testServer.html" class="external-link">shiny::testServer()</a></code> function. For an example of how to write shiny tests please see <code>/test/testthat/test-prediction-main.R</code>.</p>
<div class="section level4">
<h4 id="creating-test-files">Creating test files<a class="anchor" aria-label="anchor" href="#creating-test-files"></a>
</h4>
<p>In the test directory test files should have the prefix <code>test-*.R</code>. Naming convention for test files is: <code>test-&lt;module name&gt;-&lt;submodule&gt;.R</code> and the start of the file should use the <code>context()</code> function.</p>
<p>For resued fixtures and useful functions in tests, you can also include the files <code>tests/helper-objects.R</code> (generic objects) <code>tests/helper-&lt;module name&gt;.R</code> (objects specific to the module) which will be loaded when the tests start.</p>
<p>For example, database connection strings should be included in <code>tests/helper-objects.R</code>.</p>
<p>Tests can follow the normal <a href="https://r-pkgs.org/tests.html#test-structure" class="external-link">testthat patterns</a>, however, testing a shiny module requires loading a shiny test server that can be used to simulate user inputs and test the behaviour of <code><a href="https://rdrr.io/pkg/shiny/man/reactive.html" class="external-link">shiny::reactive</a></code> calls as well as outputs.</p>
<p>For example:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">test_that</span><span class="op">(</span><span class="st">"Example Test"</span>, <span class="op">{</span></span>
<span>  <span class="fu">shiny</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/shiny/man/testServer.html" class="external-link">testServer</a></span><span class="op">(</span><span class="va">exampleModuleServer</span>, args <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"testModule"</span><span class="op">)</span>, <span class="op">{</span></span>
<span>  </span>
<span>    <span class="co"># session$setInputs allows simulation of user behaviour</span></span>
<span>    <span class="va">session</span><span class="op">$</span><span class="fu">setInputs</span><span class="op">(</span></span>
<span>      testString <span class="op">=</span> <span class="st">"foo"</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># after modifying input output can be verified</span></span>
<span>    <span class="fu">expect_equal</span><span class="op">(</span><span class="fu">myReactive</span><span class="op">(</span><span class="op">)</span>, <span class="st">"Input is foo"</span><span class="op">)</span></span>
<span>    <span class="fu">expect_equal</span><span class="op">(</span><span class="va">output</span><span class="op">$</span><span class="va">testOutput</span>, <span class="st">"Input is foo"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="test-data-and-fixtures">Test data and fixtures<a class="anchor" aria-label="anchor" href="#test-data-and-fixtures"></a>
</h4>
<p>The modules themselves will also require test data. For that reason it is recommended that an sqlite database containing test data should either be created in <code>helper-&lt;module name..R</code> or be stored as flat files in the <code>tests/resources</code> folder. For example, currently in <code>tests/resources</code> you’ll see the file ‘databaseFile.sqlite’ that contains example prediction result data generated using the Eunomia package. This is used to test the prediction module. Please place similar files for different analyses types in this folder.</p>
</div>
<div class="section level4">
<h4 id="global-setup-files">Global setup files<a class="anchor" aria-label="anchor" href="#global-setup-files"></a>
</h4>
<p>The following <code>tests/helper-objects.R</code> file loads the required database connection string:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># setup.R</span></span>
<span><span class="va">connectionDetails</span> <span class="op">&lt;-</span> <span class="fu">DatabaseConnector</span><span class="fu">::</span><span class="fu"><a href="https://ohdsi.github.io/DatabaseConnector/reference/createConnectionDetails.html" class="external-link">createConnectionDetails</a></span><span class="op">(</span></span>
<span>  dbms <span class="op">=</span> <span class="st">'sqlite'</span>, </span>
<span>  server <span class="op">=</span> <span class="st">'testDb.sqlite'</span></span>
<span>  <span class="op">)</span>               </span></code></pre></div>
<p>Tip 1: the file <code>tests/testthat/helper-objects.R</code> contains R test code that gets executed before any other test. This is a useful place to run any generic code that may be reused in multiple test files.</p>
</div>
<div class="section level4">
<h4 id="running-tests">Running tests<a class="anchor" aria-label="anchor" href="#running-tests"></a>
</h4>
<p>These tests can then be called with the testthat command:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/testthat/man/test_dir.html" class="external-link">test_dir</a></span><span class="op">(</span><span class="st">'&lt;path_to_package&gt;/tests'</span><span class="op">)</span>  </span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a>
</h3>
<p>The current dependencies include the standard shiny packages, plotly, ggplot and a selection of helper OHDSI packages. Ideally new modules should use the existing dependencies. If a new dependency is required please post in the GitHub issues the required dependency so there can be a discussion whether to add the dependency or ‘borrow’ the specific code required by the module.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jenna Reps.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
